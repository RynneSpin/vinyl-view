// Prisma schema for Vinyl View app

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())

  // Relations
  records   Record[]

  @@index([email])
}

model Record {
  id            String   @id @default(cuid())

  // Core record information
  title         String
  artist        String
  label         String?
  year          Int?

  // Discogs data
  discogsId     String?
  discogsUrl    String?

  // Barcode/identifiers
  upc           String?
  catno         String?  // Catalog number

  // Format details
  format        String?  // e.g., "LP", "12\"", "7\""
  formatDesc    String?  // e.g., "Vinyl, LP, Album, Reissue"
  speed         String?  // e.g., "33 â…“ RPM"

  // Genre/style
  genres        String[] // Array of genres
  styles        String[] // Array of styles

  // Tracklist (stored as JSON array of {position, title, duration})
  tracklist     Json?

  // Media
  coverArtUrl   String?
  thumbnailUrl  String?

  // Additional info
  country       String?
  released      String?  // Release date string
  notes         String?  // User notes

  // Metadata
  dateAdded     DateTime @default(now())
  dateUpdated   DateTime @updatedAt

  // User relationship
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([artist])
  @@index([title])
  @@index([discogsId])
  @@index([upc])
  @@index([dateAdded])
  @@index([userId])
  @@index([userId, dateAdded])
  @@unique([userId, discogsId])
}

// Optional: Track searches for caching
model DiscogsCache {
  id            String   @id @default(cuid())
  query         String   @unique
  queryType     String   // "search", "release", "barcode"
  response      Json
  createdAt     DateTime @default(now())
  expiresAt     DateTime

  @@index([query, queryType])
  @@index([expiresAt])
}
